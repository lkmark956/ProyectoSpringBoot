<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaaS Platform - Gesti√≥n de Planes</title>
    <!-- TailwindCSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            500: '#FF6600',
                            600: '#E55A00',
                            700: '#CC5000'
                        },
                        secondary: {
                            500: '#5B2C6F',
                            600: '#4A2459',
                            700: '#3A1C47',
                            800: '#2D1B3D'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #FF6600;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-secondary-500 to-secondary-700 text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-bold">üöÄ SaaS Platform</h1>
                <nav class="flex space-x-2">
                    <a href="index.html" class="px-4 py-2 rounded-full bg-primary-500 text-white font-medium">
                        üìã Planes
                    </a>
                    <a href="usuarios.html" class="px-4 py-2 rounded-full text-gray-200 hover:bg-white/20 font-medium">
                        üë• Usuarios
                    </a>
                    <a href="suscripciones.html" class="px-4 py-2 rounded-full text-gray-200 hover:bg-white/20 font-medium">
                        üìù Suscripciones
                    </a>
                    <a href="facturas.html" class="px-4 py-2 rounded-full text-gray-200 hover:bg-white/20 font-medium">
                        üßæ Facturas
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Contenido Principal -->
    <main class="container mx-auto px-4 py-8">
        <!-- T√≠tulo y bot√≥n nuevo -->
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-3xl font-bold text-gray-800">üìã Gesti√≥n de Planes</h2>
                <p class="text-gray-600 mt-1">Administra los planes de suscripci√≥n (BASIC, PREMIUM, ENTERPRISE)</p>
            </div>
            <button onclick="mostrarFormulario()" 
                    class="bg-primary-500 hover:bg-primary-600 text-white px-6 py-3 rounded-full font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all">
                ‚ûï Nuevo Plan
            </button>
        </div>

        <!-- Mensajes -->
        <div id="mensaje" class="hidden p-4 rounded-lg mb-6"></div>

        <!-- Error de conexi√≥n -->
        <div id="errorConexion" class="hidden bg-red-100 border-l-4 border-red-500 p-4 rounded-lg mb-6">
            <p class="text-red-700 font-semibold">‚ùå Error de conexi√≥n con el servidor</p>
            <p class="text-red-600 text-sm mt-1">
                Ejecuta: <code class="bg-red-200 px-2 py-1 rounded">.\mvnw.cmd spring-boot:run</code> en el backend
            </p>
        </div>

        <!-- Modal Formulario -->
        <div id="modalFormulario" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 w-full max-w-2xl shadow-2xl max-h-[90vh] overflow-y-auto">
                <h3 id="tituloFormulario" class="text-2xl font-bold mb-6">‚ûï Nuevo Plan</h3>
                
                <form id="formPlan" class="space-y-4">
                    <input type="hidden" id="planId">
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1">Nombre del Plan *</label>
                            <input type="text" id="nombre" required
                                   class="w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-primary-500 focus:outline-none"
                                   placeholder="Ej: Plan Profesional">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1">Tipo de Plan *</label>
                            <select id="tipoPlan" required
                                    class="w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-primary-500 focus:outline-none">
                                <option value="BASIC">ü•â BASIC</option>
                                <option value="PREMIUM">ü•à PREMIUM</option>
                                <option value="ENTERPRISE">ü•á ENTERPRISE</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1">Precio Mensual (‚Ç¨) *</label>
                            <input type="number" step="0.01" id="precioMensual" required
                                   class="w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-primary-500 focus:outline-none"
                                   placeholder="29.99">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1">Almacenamiento (GB)</label>
                            <input type="number" id="almacenamientoGb"
                                   class="w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-primary-500 focus:outline-none"
                                   placeholder="100">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1">M√°x. Usuarios</label>
                            <input type="number" id="maxUsuarios"
                                   class="w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-primary-500 focus:outline-none"
                                   placeholder="50">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Descripci√≥n</label>
                        <textarea id="descripcion" rows="3"
                                  class="w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-primary-500 focus:outline-none"
                                  placeholder="Describe las caracter√≠sticas del plan..."></textarea>
                    </div>

                    <div class="flex gap-6">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="soportePrioritario" class="w-5 h-5 text-primary-500 rounded">
                            <span class="ml-2">üéß Soporte Prioritario</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="activo" checked class="w-5 h-5 text-primary-500 rounded">
                            <span class="ml-2">‚úÖ Plan Activo</span>
                        </label>
                    </div>

                    <div class="flex justify-end gap-3 pt-4">
                        <button type="button" onclick="cerrarFormulario()"
                                class="px-6 py-2 bg-gray-200 hover:bg-gray-300 rounded-full font-medium transition-all">
                            Cancelar
                        </button>
                        <button type="submit"
                                class="px-6 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-full font-medium transition-all">
                            üíæ Guardar Plan
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabla de Planes -->
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
            <div id="loading" class="flex items-center justify-center py-12">
                <div class="loader mr-3"></div>
                <span class="text-gray-500">Cargando planes...</span>
            </div>
            
            <table id="tablaPlanes" class="hidden w-full">
                <thead class="bg-gradient-to-r from-secondary-500 to-secondary-700 text-white">
                    <tr>
                        <th class="px-6 py-4 text-left font-semibold">ID</th>
                        <th class="px-6 py-4 text-left font-semibold">Nombre</th>
                        <th class="px-6 py-4 text-left font-semibold">Tipo</th>
                        <th class="px-6 py-4 text-left font-semibold">Precio</th>
                        <th class="px-6 py-4 text-left font-semibold">Almacenamiento</th>
                        <th class="px-6 py-4 text-left font-semibold">Usuarios</th>
                        <th class="px-6 py-4 text-left font-semibold">Acciones</th>
                    </tr>
                </thead>
                <tbody id="cuerpoTabla" class="divide-y divide-gray-200">
                    <!-- Los planes se cargan aqu√≠ din√°micamente -->
                </tbody>
            </table>

            <div id="sinPlanes" class="hidden text-center py-12">
                <p class="text-5xl mb-4">üì≠</p>
                <h3 class="text-xl font-bold text-gray-700">No hay planes disponibles</h3>
                <p class="text-gray-500 mt-2">Crea tu primer plan para comenzar</p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-secondary-800 text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-300">¬© 2026 SaaS Platform - Proyecto Spring Boot</p>
            <p class="text-sm text-gray-400 mt-1">Desarrollo de Interfaces - 2¬∫ Trimestre - Semana 1</p>
        </div>
    </footer>

    <script>
        const API_URL = 'http://localhost:8080/api';
        let planes = [];

        // Cargar planes al iniciar
        document.addEventListener('DOMContentLoaded', cargarPlanes);

        async function cargarPlanes() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('tablaPlanes').classList.add('hidden');
            document.getElementById('sinPlanes').classList.add('hidden');
            document.getElementById('errorConexion').classList.add('hidden');

            try {
                const response = await fetch(`${API_URL}/planes`);
                if (!response.ok) throw new Error('Error en la respuesta');
                
                planes = await response.json();
                document.getElementById('loading').classList.add('hidden');
                
                if (planes.length === 0) {
                    document.getElementById('sinPlanes').classList.remove('hidden');
                } else {
                    renderizarPlanes();
                    document.getElementById('tablaPlanes').classList.remove('hidden');
                }
            } catch (error) {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('errorConexion').classList.remove('hidden');
                console.error('Error:', error);
            }
        }

        function renderizarPlanes() {
            const tbody = document.getElementById('cuerpoTabla');
            tbody.innerHTML = planes.map(plan => `
                <tr class="hover:bg-orange-50 transition-colors">
                    <td class="px-6 py-4 font-bold text-gray-800">${plan.id}</td>
                    <td class="px-6 py-4 font-semibold">${plan.nombre}</td>
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 rounded-full text-white text-sm font-semibold ${getBadgeColor(plan.tipoPlan)}">
                            ${plan.tipoPlan}
                        </span>
                    </td>
                    <td class="px-6 py-4 font-bold">${formatPrice(plan.precioMensual)} ‚Ç¨</td>
                    <td class="px-6 py-4">${plan.almacenamientoGb || '-'} GB</td>
                    <td class="px-6 py-4">${plan.maxUsuarios || '-'}</td>
                    <td class="px-6 py-4">
                        <button onclick="editarPlan(${plan.id})" 
                                class="px-3 py-1 bg-yellow-400 hover:bg-yellow-500 text-gray-800 rounded-lg text-sm font-medium mr-2 transition-all">
                            ‚úèÔ∏è Editar
                        </button>
                        <button onclick="eliminarPlan(${plan.id}, '${plan.nombre}')" 
                                class="px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-all">
                            üóëÔ∏è Eliminar
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getBadgeColor(tipo) {
            switch(tipo) {
                case 'BASIC': return 'bg-gray-500';
                case 'PREMIUM': return 'bg-primary-500';
                case 'ENTERPRISE': return 'bg-secondary-500';
                default: return 'bg-gray-400';
            }
        }

        function formatPrice(price) {
            return parseFloat(price).toFixed(2);
        }

        function mostrarFormulario(plan = null) {
            document.getElementById('modalFormulario').classList.remove('hidden');
            
            if (plan) {
                document.getElementById('tituloFormulario').textContent = '‚úèÔ∏è Editar Plan';
                document.getElementById('planId').value = plan.id;
                document.getElementById('nombre').value = plan.nombre;
                document.getElementById('tipoPlan').value = plan.tipoPlan;
                document.getElementById('precioMensual').value = plan.precioMensual;
                document.getElementById('almacenamientoGb').value = plan.almacenamientoGb || '';
                document.getElementById('maxUsuarios').value = plan.maxUsuarios || '';
                document.getElementById('descripcion').value = plan.descripcion || '';
                document.getElementById('soportePrioritario').checked = plan.soportePrioritario;
                document.getElementById('activo').checked = plan.activo;
            } else {
                document.getElementById('tituloFormulario').textContent = '‚ûï Nuevo Plan';
                document.getElementById('formPlan').reset();
                document.getElementById('planId').value = '';
                document.getElementById('activo').checked = true;
            }
        }

        function cerrarFormulario() {
            document.getElementById('modalFormulario').classList.add('hidden');
        }

        async function editarPlan(id) {
            const plan = planes.find(p => p.id === id);
            if (plan) mostrarFormulario(plan);
        }

        async function eliminarPlan(id, nombre) {
            if (!confirm(`¬øEliminar el plan "${nombre}"?`)) return;

            try {
                const response = await fetch(`${API_URL}/planes/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    mostrarMensaje(`üóëÔ∏è Plan "${nombre}" eliminado correctamente`, 'success');
                    cargarPlanes();
                } else {
                    throw new Error('Error al eliminar');
                }
            } catch (error) {
                mostrarMensaje('‚ùå Error al eliminar el plan', 'error');
            }
        }

        document.getElementById('formPlan').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const planData = {
                nombre: document.getElementById('nombre').value,
                tipoPlan: document.getElementById('tipoPlan').value,
                precioMensual: parseFloat(document.getElementById('precioMensual').value),
                almacenamientoGb: parseInt(document.getElementById('almacenamientoGb').value) || null,
                maxUsuarios: parseInt(document.getElementById('maxUsuarios').value) || null,
                descripcion: document.getElementById('descripcion').value || null,
                soportePrioritario: document.getElementById('soportePrioritario').checked,
                activo: document.getElementById('activo').checked
            };

            const planId = document.getElementById('planId').value;
            const isEdit = planId !== '';

            try {
                const response = await fetch(
                    isEdit ? `${API_URL}/planes/${planId}` : `${API_URL}/planes`,
                    {
                        method: isEdit ? 'PUT' : 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(planData)
                    }
                );

                if (response.ok) {
                    cerrarFormulario();
                    mostrarMensaje(
                        isEdit 
                            ? `‚úÖ Plan "${planData.nombre}" actualizado correctamente`
                            : `‚úÖ Plan "${planData.nombre}" (${planData.tipoPlan}) creado correctamente`,
                        'success'
                    );
                    cargarPlanes();
                } else {
                    throw new Error('Error en la operaci√≥n');
                }
            } catch (error) {
                mostrarMensaje('‚ùå Error al guardar el plan', 'error');
            }
        });

        function mostrarMensaje(texto, tipo) {
            const div = document.getElementById('mensaje');
            div.textContent = texto;
            div.className = `p-4 rounded-lg mb-6 ${tipo === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`;
            div.classList.remove('hidden');
            
            setTimeout(() => div.classList.add('hidden'), 4000);
        }
    </script>
</body>
</html>
